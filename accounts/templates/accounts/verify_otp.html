{% extends '_base.html' %}
{% load crispy_forms_filters %}
{% load crispy_forms_tags %}
{% load static %}
{% load i18n %}

{% block page_title %}{% trans 'تایید شماره موبایل' %}{% endblock page_title %}

{% block content %}

<!-- Breadcrumb area Start -->
<div class="breadcrumb-area bg-color ptb--90" data-bg-color="#f6f6f6" style="text-align: right">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center flex-sm-row flex-column">
                    <h1 class="page-title" style="margin: 0 auto">{% trans 'Account' %}</h1>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Breadcrumb area End -->

    <!-- Main Content Wrapper Start -->
    <div class="main-content-wrapper" style="direction: rtl;">
        <div class="page-content-inner pt--75 pb--80">
            <div class="container">
                <div class="row">
                    <div class="col-md-6" style="margin: 0 auto; text-align: right;">
                        <div class="register-box">
                            <h2 style="text-align: center;">{% trans 'Authentication' %}</h2>
                            <p style="text-align: center;">{% trans 'A 4-digit verification code has been sent to you. Please enter it in the box below.' %}</p>
                            <br>

                            <!-- تایمر -->
                            <p style="text-align:center; margin-top:15px;">
                                {% trans "Time remaining " %} <span id="otp-timer">02:00</span>
                            </p>

                            <!-- لینک ارسال مجدد OTP -->
                            <p id="otp-expired-text" style="text-align:center; color: red; display:none;">
                                {% trans 'The code sent has expired. Please get a new one.' %}
                                <a href="{% url 'login' %}" style="color: blue; text-decoration: underline;">
                                    {% trans "Send again" %}
                                </a>
                            </p>

                            <form class="form form--login" action="" method="post" style="text-align: right;">
                                {% csrf_token %}
                                {{ form|crispy }}
                                <div class="form__group" style="text-align:center; margin-top: 15px;">
                                    <input type="submit" value="{% trans 'Login' %}" class="btn btn-submit btn-style-1">
                                </div>
                            </form>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Main Content Wrapper End -->

    <script>
        let totalSeconds = 120; // 2 دقیقه
        const timer = document.getElementById("otp-timer");
        const expiredText = document.getElementById("otp-expired-text");

        function startTimer() {
            let remaining = totalSeconds;
            expiredText.style.display = "none";
            updateTimerDisplay(remaining);

            const interval = setInterval(() => {
                remaining--;
                if (remaining >= 0) {
                    updateTimerDisplay(remaining);
                } else {
                    clearInterval(interval);
                    timer.textContent = "00:00";
                    expiredText.style.display = "block"; // نمایش لینک متنی
                }
            }, 1000);
        }

        function updateTimerDisplay(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            timer.textContent = `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        window.addEventListener("load", startTimer);
    </script>

{% endblock content %}
